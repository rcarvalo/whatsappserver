<mxfile host="app.diagrams.net" modified="2024-01-15T11:00:00.000Z" agent="5.0">
  <diagram name="Architecture Globale Système" id="global-architecture">
    <mxGraphModel dx="1422" dy="758" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Titre -->
        <mxCell id="title" value="🏗️ Architecture Globale - WhatsApp RAG System" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="20" width="500" height="40" as="geometry" />
        </mxCell>

        <!-- Section Sources de Données -->
        <mxCell id="data-sources-title" value="📱 SOURCES DE DONNÉES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- WhatsApp Groups -->
        <mxCell id="whatsapp-groups" value="💬 Groupes WhatsApp&#xa;&#xa;• Groupe Rolex Passion&#xa;• Montres Vintage France&#xa;• Omega Collectors&#xa;• Tudor Community&#xa;• AP & Patek Philippe" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="120" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- Section Processing Server -->
        <mxCell id="server-title" value="🌐 SERVEUR DE TRAITEMENT" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="80" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- WhatsApp Webhook -->
        <mxCell id="webhook-receiver" value="🔗 Webhook Receiver&#xa;(app.py)&#xa;&#xa;• FastAPI Server&#xa;• Validation des messages&#xa;• Rate limiting&#xa;• Error handling" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="280" y="120" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- LLM Extractor -->
        <mxCell id="llm-extractor-global" value="🤖 LLM Extractor&#xa;(GPT-4o-mini)&#xa;&#xa;• Extraction structurée&#xa;• Prompt engineering&#xa;• Cache intelligent&#xa;• Fallback regex" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="280" y="240" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Section Base de Données -->
        <mxCell id="database-title" value="🗄️ BASE DE DONNÉES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="80" width="180" height="30" as="geometry" />
        </mxCell>

        <!-- Supabase -->
        <mxCell id="supabase-db" value="🏢 Supabase PostgreSQL&#xa;&#xa;📊 Table: watch_conversations&#xa;• 25+ champs structurés&#xa;• Embeddings vectoriels&#xa;• Index optimisés&#xa;• Fonctions SQL custom&#xa;• Triggers automatiques" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="520" y="120" width="200" height="140" as="geometry" />
        </mxCell>

        <!-- Analytics Engine -->
        <mxCell id="analytics-engine" value="📈 Analytics Engine&#xa;&#xa;• Fonctions SQL avancées&#xa;• Statistiques temps réel&#xa;• Tendances de marché&#xa;• Insights automatiques" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="520" y="280" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Section Applications Client -->
        <mxCell id="client-apps-title" value="👥 APPLICATIONS CLIENT" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="780" y="80" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- Telegram Bot -->
        <mxCell id="telegram-bot-global" value="🤖 Telegram Bot&#xa;(telegram_rag_bot.py)&#xa;&#xa;• Interface conversationnelle&#xa;• Commandes intelligentes&#xa;• Recherche en langage naturel&#xa;• Notifications et alertes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="780" y="120" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Web Dashboard -->
        <mxCell id="web-dashboard" value="🌐 Web Dashboard&#xa;(Futur)&#xa;&#xa;• Interface web complète&#xa;• Graphiques interactifs&#xa;• Exports de données&#xa;• Admin panel" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;fillStyle=dashed;" vertex="1" parent="1">
          <mxGeometry x="780" y="260" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Section Services Externes -->
        <mxCell id="external-title" value="🔌 SERVICES EXTERNES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="80" width="180" height="30" as="geometry" />
        </mxCell>

        <!-- OpenAI -->
        <mxCell id="openai-service" value="🧠 OpenAI API&#xa;&#xa;• GPT-4o-mini&#xa;• Text embeddings&#xa;• Structured output&#xa;• Rate limiting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="1020" y="120" width="160" height="100" as="geometry" />
        </mxCell>

        <!-- WhatsApp Business API -->
        <mxCell id="whatsapp-api" value="📱 WhatsApp Business API&#xa;&#xa;• Webhook notifications&#xa;• Message metadata&#xa;• Group information&#xa;• User profiles" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="1020" y="240" width="160" height="100" as="geometry" />
        </mxCell>

        <!-- Telegram API -->
        <mxCell id="telegram-api" value="💬 Telegram Bot API&#xa;&#xa;• Bot interactions&#xa;• Message sending&#xa;• Inline keyboards&#xa;• File uploads" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="1020" y="360" width="160" height="100" as="geometry" />
        </mxCell>

        <!-- Flux de données principales -->
        <mxCell id="flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#d6b656;" edge="1" parent="1" source="whatsapp-groups" target="webhook-receiver">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#d6b656;" edge="1" parent="1" source="webhook-receiver" target="llm-extractor-global">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#82b366;" edge="1" parent="1" source="llm-extractor-global" target="supabase-db">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="480" y="290" />
              <mxPoint x="480" y="190" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="flow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#b85450;" edge="1" parent="1" source="supabase-db" target="telegram-bot-global">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#9673a6;" edge="1" parent="1" source="supabase-db" target="analytics-engine">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Connexions API externes -->
        <mxCell id="api1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;strokeStyle=dashed;" edge="1" parent="1" source="llm-extractor-global" target="openai-service">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="500" y="290" />
              <mxPoint x="500" y="170" />
              <mxPoint x="1000" y="170" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="api2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;strokeStyle=dashed;" edge="1" parent="1" source="webhook-receiver" target="whatsapp-api">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="500" y="170" />
              <mxPoint x="1000" y="170" />
              <mxPoint x="1000" y="290" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="api3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;strokeStyle=dashed;" edge="1" parent="1" source="telegram-bot-global" target="telegram-api">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1000" y="180" />
              <mxPoint x="1000" y="410" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Labels des flux -->
        <mxCell id="label-webhook" value="Webhooks&#xa;temps réel" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="230" y="150" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="label-extraction" value="Extraction&#xa;intelligente" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="360" y="190" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="label-storage" value="Stockage&#xa;optimisé" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="480" y="220" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="label-search" value="Recherche&#xa;RAG" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="730" y="150" width="60" height="30" as="geometry" />
        </mxCell>

        <!-- Section Déploiement -->
        <mxCell id="deploy-title" value="☁️ DÉPLOIEMENT" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="420" width="120" height="30" as="geometry" />
        </mxCell>

        <!-- Production Server -->
        <mxCell id="prod-server" value="🌐 Production Server&#xa;(Render/Railway)&#xa;&#xa;• whatsapp-rag-server&#xa;• Auto-scaling&#xa;• Health monitoring&#xa;• SSL/HTTPS&#xa;• Environment variables" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Client Deployment -->
        <mxCell id="client-deploy" value="🤖 Client Deployment&#xa;(VPS/Local)&#xa;&#xa;• whatsapp-rag-client&#xa;• Telegram bot hosting&#xa;• Monitoring & logs&#xa;• Auto-restart&#xa;• Backup configs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="280" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Database Cloud -->
        <mxCell id="db-cloud" value="☁️ Database Cloud&#xa;(Supabase)&#xa;&#xa;• Managed PostgreSQL&#xa;• Vector extensions&#xa;• Real-time subscriptions&#xa;• Row Level Security&#xa;• Automatic backups" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="510" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Section Monitoring -->
        <mxCell id="monitoring-title" value="📊 MONITORING & ANALYTICS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="750" y="420" width="220" height="30" as="geometry" />
        </mxCell>

        <!-- Metrics -->
        <mxCell id="metrics" value="📈 Métriques en Temps Réel&#xa;&#xa;• Messages traités/min&#xa;• Précision extraction LLM&#xa;• Temps de réponse&#xa;• Taux d'erreur API&#xa;• Utilisation cache&#xa;• Requêtes utilisateurs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="750" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Alerts -->
        <mxCell id="alerts" value="🚨 Alertes & Notifications&#xa;&#xa;• Erreurs système&#xa;• Quotas API dépassés&#xa;• Performance dégradée&#xa;• Nouvelles opportunités&#xa;• Maintenance requise&#xa;• Mises à jour disponibles" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="980" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Section Performance -->
        <mxCell id="performance-title" value="⚡ PERFORMANCE & OPTIMISATIONS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="200" y="620" width="280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="perf-metrics" value="📊 Métriques de Performance&#xa;&#xa;• Extraction LLM: ~1-2s&#xa;• Cache hit: &lt;50ms&#xa;• Recherche vectorielle: &lt;100ms&#xa;• Webhook processing: &lt;200ms&#xa;• Bot response: &lt;2s&#xa;• Database queries: &lt;50ms&#xa;• Concurrent users: 100+&#xa;• Messages/day: 10,000+" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="660" width="250" height="160" as="geometry" />
        </mxCell>

        <mxCell id="optimizations" value="🚀 Optimisations Implémentées&#xa;&#xa;• Cache LLM intelligent&#xa;• Index vectoriels pgvector&#xa;• Connection pooling&#xa;• Batch processing&#xa;• Async operations&#xa;• Rate limiting&#xa;• Compression & CDN&#xa;• Lazy loading&#xa;• Query optimization&#xa;• Memory management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="660" width="250" height="160" as="geometry" />
        </mxCell>

        <mxCell id="scalability" value="📈 Scalabilité & Évolution&#xa;&#xa;• Architecture microservices ready&#xa;• Horizontal scaling capable&#xa;• Load balancer compatible&#xa;• Container orchestration&#xa;• Multi-region deployment&#xa;• Auto-scaling triggers&#xa;• Backup & disaster recovery&#xa;• Rolling updates&#xa;• Blue-green deployment&#xa;• Performance monitoring" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="590" y="660" width="250" height="160" as="geometry" />
        </mxCell>

        <mxCell id="future" value="🔮 Évolutions Futures&#xa;&#xa;• Fine-tuning modèle spécialisé&#xa;• Vision AI pour images&#xa;• Support audio/vocal&#xa;• ML price prediction&#xa;• Blockchain integration&#xa;• Multi-marketplace&#xa;• Advanced analytics&#xa;• Mobile app native&#xa;• AR/VR experiences&#xa;• Community features" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="860" y="660" width="250" height="160" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
