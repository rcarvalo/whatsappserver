<mxfile host="app.diagrams.net" modified="2024-01-15T11:00:00.000Z" agent="5.0">
  <diagram name="Architecture Globale SystÃ¨me" id="global-architecture">
    <mxGraphModel dx="1422" dy="758" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Titre -->
        <mxCell id="title" value="ðŸ—ï¸ Architecture Globale - WhatsApp RAG System" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="20" width="500" height="40" as="geometry" />
        </mxCell>

        <!-- Section Sources de DonnÃ©es -->
        <mxCell id="data-sources-title" value="ðŸ“± SOURCES DE DONNÃ‰ES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- WhatsApp Groups -->
        <mxCell id="whatsapp-groups" value="ðŸ’¬ Groupes WhatsApp&#xa;&#xa;â€¢ Groupe Rolex Passion&#xa;â€¢ Montres Vintage France&#xa;â€¢ Omega Collectors&#xa;â€¢ Tudor Community&#xa;â€¢ AP & Patek Philippe" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="120" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- Section Processing Server -->
        <mxCell id="server-title" value="ðŸŒ SERVEUR DE TRAITEMENT" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="80" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- WhatsApp Webhook -->
        <mxCell id="webhook-receiver" value="ðŸ”— Webhook Receiver&#xa;(app.py)&#xa;&#xa;â€¢ FastAPI Server&#xa;â€¢ Validation des messages&#xa;â€¢ Rate limiting&#xa;â€¢ Error handling" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="280" y="120" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- LLM Extractor -->
        <mxCell id="llm-extractor-global" value="ðŸ¤– LLM Extractor&#xa;(GPT-4o-mini)&#xa;&#xa;â€¢ Extraction structurÃ©e&#xa;â€¢ Prompt engineering&#xa;â€¢ Cache intelligent&#xa;â€¢ Fallback regex" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="280" y="240" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Section Base de DonnÃ©es -->
        <mxCell id="database-title" value="ðŸ—„ï¸ BASE DE DONNÃ‰ES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="80" width="180" height="30" as="geometry" />
        </mxCell>

        <!-- Supabase -->
        <mxCell id="supabase-db" value="ðŸ¢ Supabase PostgreSQL&#xa;&#xa;ðŸ“Š Table: watch_conversations&#xa;â€¢ 25+ champs structurÃ©s&#xa;â€¢ Embeddings vectoriels&#xa;â€¢ Index optimisÃ©s&#xa;â€¢ Fonctions SQL custom&#xa;â€¢ Triggers automatiques" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="520" y="120" width="200" height="140" as="geometry" />
        </mxCell>

        <!-- Analytics Engine -->
        <mxCell id="analytics-engine" value="ðŸ“ˆ Analytics Engine&#xa;&#xa;â€¢ Fonctions SQL avancÃ©es&#xa;â€¢ Statistiques temps rÃ©el&#xa;â€¢ Tendances de marchÃ©&#xa;â€¢ Insights automatiques" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="520" y="280" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Section Applications Client -->
        <mxCell id="client-apps-title" value="ðŸ‘¥ APPLICATIONS CLIENT" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="780" y="80" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- Telegram Bot -->
        <mxCell id="telegram-bot-global" value="ðŸ¤– Telegram Bot&#xa;(telegram_rag_bot.py)&#xa;&#xa;â€¢ Interface conversationnelle&#xa;â€¢ Commandes intelligentes&#xa;â€¢ Recherche en langage naturel&#xa;â€¢ Notifications et alertes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="780" y="120" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Web Dashboard -->
        <mxCell id="web-dashboard" value="ðŸŒ Web Dashboard&#xa;(Futur)&#xa;&#xa;â€¢ Interface web complÃ¨te&#xa;â€¢ Graphiques interactifs&#xa;â€¢ Exports de donnÃ©es&#xa;â€¢ Admin panel" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;fillStyle=dashed;" vertex="1" parent="1">
          <mxGeometry x="780" y="260" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Section Services Externes -->
        <mxCell id="external-title" value="ðŸ”Œ SERVICES EXTERNES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="80" width="180" height="30" as="geometry" />
        </mxCell>

        <!-- OpenAI -->
        <mxCell id="openai-service" value="ðŸ§  OpenAI API&#xa;&#xa;â€¢ GPT-4o-mini&#xa;â€¢ Text embeddings&#xa;â€¢ Structured output&#xa;â€¢ Rate limiting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="1020" y="120" width="160" height="100" as="geometry" />
        </mxCell>

        <!-- WhatsApp Business API -->
        <mxCell id="whatsapp-api" value="ðŸ“± WhatsApp Business API&#xa;&#xa;â€¢ Webhook notifications&#xa;â€¢ Message metadata&#xa;â€¢ Group information&#xa;â€¢ User profiles" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="1020" y="240" width="160" height="100" as="geometry" />
        </mxCell>

        <!-- Telegram API -->
        <mxCell id="telegram-api" value="ðŸ’¬ Telegram Bot API&#xa;&#xa;â€¢ Bot interactions&#xa;â€¢ Message sending&#xa;â€¢ Inline keyboards&#xa;â€¢ File uploads" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="1020" y="360" width="160" height="100" as="geometry" />
        </mxCell>

        <!-- Flux de donnÃ©es principales -->
        <mxCell id="flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#d6b656;" edge="1" parent="1" source="whatsapp-groups" target="webhook-receiver">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#d6b656;" edge="1" parent="1" source="webhook-receiver" target="llm-extractor-global">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#82b366;" edge="1" parent="1" source="llm-extractor-global" target="supabase-db">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="480" y="290" />
              <mxPoint x="480" y="190" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="flow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#b85450;" edge="1" parent="1" source="supabase-db" target="telegram-bot-global">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#9673a6;" edge="1" parent="1" source="supabase-db" target="analytics-engine">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Connexions API externes -->
        <mxCell id="api1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;strokeStyle=dashed;" edge="1" parent="1" source="llm-extractor-global" target="openai-service">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="500" y="290" />
              <mxPoint x="500" y="170" />
              <mxPoint x="1000" y="170" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="api2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;strokeStyle=dashed;" edge="1" parent="1" source="webhook-receiver" target="whatsapp-api">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="500" y="170" />
              <mxPoint x="1000" y="170" />
              <mxPoint x="1000" y="290" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="api3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;strokeStyle=dashed;" edge="1" parent="1" source="telegram-bot-global" target="telegram-api">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1000" y="180" />
              <mxPoint x="1000" y="410" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Labels des flux -->
        <mxCell id="label-webhook" value="Webhooks&#xa;temps rÃ©el" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="230" y="150" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="label-extraction" value="Extraction&#xa;intelligente" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="360" y="190" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="label-storage" value="Stockage&#xa;optimisÃ©" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="480" y="220" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="label-search" value="Recherche&#xa;RAG" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="730" y="150" width="60" height="30" as="geometry" />
        </mxCell>

        <!-- Section DÃ©ploiement -->
        <mxCell id="deploy-title" value="â˜ï¸ DÃ‰PLOIEMENT" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="420" width="120" height="30" as="geometry" />
        </mxCell>

        <!-- Production Server -->
        <mxCell id="prod-server" value="ðŸŒ Production Server&#xa;(Render/Railway)&#xa;&#xa;â€¢ whatsapp-rag-server&#xa;â€¢ Auto-scaling&#xa;â€¢ Health monitoring&#xa;â€¢ SSL/HTTPS&#xa;â€¢ Environment variables" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Client Deployment -->
        <mxCell id="client-deploy" value="ðŸ¤– Client Deployment&#xa;(VPS/Local)&#xa;&#xa;â€¢ whatsapp-rag-client&#xa;â€¢ Telegram bot hosting&#xa;â€¢ Monitoring & logs&#xa;â€¢ Auto-restart&#xa;â€¢ Backup configs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="280" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Database Cloud -->
        <mxCell id="db-cloud" value="â˜ï¸ Database Cloud&#xa;(Supabase)&#xa;&#xa;â€¢ Managed PostgreSQL&#xa;â€¢ Vector extensions&#xa;â€¢ Real-time subscriptions&#xa;â€¢ Row Level Security&#xa;â€¢ Automatic backups" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="510" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Section Monitoring -->
        <mxCell id="monitoring-title" value="ðŸ“Š MONITORING & ANALYTICS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="750" y="420" width="220" height="30" as="geometry" />
        </mxCell>

        <!-- Metrics -->
        <mxCell id="metrics" value="ðŸ“ˆ MÃ©triques en Temps RÃ©el&#xa;&#xa;â€¢ Messages traitÃ©s/min&#xa;â€¢ PrÃ©cision extraction LLM&#xa;â€¢ Temps de rÃ©ponse&#xa;â€¢ Taux d'erreur API&#xa;â€¢ Utilisation cache&#xa;â€¢ RequÃªtes utilisateurs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="750" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Alerts -->
        <mxCell id="alerts" value="ðŸš¨ Alertes & Notifications&#xa;&#xa;â€¢ Erreurs systÃ¨me&#xa;â€¢ Quotas API dÃ©passÃ©s&#xa;â€¢ Performance dÃ©gradÃ©e&#xa;â€¢ Nouvelles opportunitÃ©s&#xa;â€¢ Maintenance requise&#xa;â€¢ Mises Ã  jour disponibles" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="980" y="460" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Section Performance -->
        <mxCell id="performance-title" value="âš¡ PERFORMANCE & OPTIMISATIONS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="200" y="620" width="280" height="30" as="geometry" />
        </mxCell>

        <mxCell id="perf-metrics" value="ðŸ“Š MÃ©triques de Performance&#xa;&#xa;â€¢ Extraction LLM: ~1-2s&#xa;â€¢ Cache hit: &lt;50ms&#xa;â€¢ Recherche vectorielle: &lt;100ms&#xa;â€¢ Webhook processing: &lt;200ms&#xa;â€¢ Bot response: &lt;2s&#xa;â€¢ Database queries: &lt;50ms&#xa;â€¢ Concurrent users: 100+&#xa;â€¢ Messages/day: 10,000+" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="660" width="250" height="160" as="geometry" />
        </mxCell>

        <mxCell id="optimizations" value="ðŸš€ Optimisations ImplÃ©mentÃ©es&#xa;&#xa;â€¢ Cache LLM intelligent&#xa;â€¢ Index vectoriels pgvector&#xa;â€¢ Connection pooling&#xa;â€¢ Batch processing&#xa;â€¢ Async operations&#xa;â€¢ Rate limiting&#xa;â€¢ Compression & CDN&#xa;â€¢ Lazy loading&#xa;â€¢ Query optimization&#xa;â€¢ Memory management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="660" width="250" height="160" as="geometry" />
        </mxCell>

        <mxCell id="scalability" value="ðŸ“ˆ ScalabilitÃ© & Ã‰volution&#xa;&#xa;â€¢ Architecture microservices ready&#xa;â€¢ Horizontal scaling capable&#xa;â€¢ Load balancer compatible&#xa;â€¢ Container orchestration&#xa;â€¢ Multi-region deployment&#xa;â€¢ Auto-scaling triggers&#xa;â€¢ Backup & disaster recovery&#xa;â€¢ Rolling updates&#xa;â€¢ Blue-green deployment&#xa;â€¢ Performance monitoring" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="590" y="660" width="250" height="160" as="geometry" />
        </mxCell>

        <mxCell id="future" value="ðŸ”® Ã‰volutions Futures&#xa;&#xa;â€¢ Fine-tuning modÃ¨le spÃ©cialisÃ©&#xa;â€¢ Vision AI pour images&#xa;â€¢ Support audio/vocal&#xa;â€¢ ML price prediction&#xa;â€¢ Blockchain integration&#xa;â€¢ Multi-marketplace&#xa;â€¢ Advanced analytics&#xa;â€¢ Mobile app native&#xa;â€¢ AR/VR experiences&#xa;â€¢ Community features" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="860" y="660" width="250" height="160" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
